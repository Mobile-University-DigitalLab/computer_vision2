valid_data = valid_dl,
verbose = TRUE
)
fitted <- convnet %>%
setup(
loss = nn_cross_entropy_loss(),
optimizer = optim_adam,
metrics = list(
luz_metric_accuracy()
)
) %>%
fit(train_dl,
epochs = 10,
valid_data = valid_dl,
verbose = TRUE
)
rm(list=ls())
if (!require("ggplot2")) install.packages("ggplot2")
if (!require("dplyr")) install.packages("dplyr")
if (!require("export")) install.packages("export")
if (!require("GGally")) install.packages("GGally")
if (!require("magrittr")) install.packages("magrittr")
library(dplyr)
bikesharing <- read.csv("https://raw.githubusercontent.com/christophM/interpretable-ml-book/master/data/bike-sharing-daily.csv")
bikesharing <- bikesharing %>%
mutate(
weekday_fct = factor(x = weekday,
levels = c(0,1,2,3,4,5,6),
labels = c("Sunday",
"Monday",
"Tuesday",
"Wednesday",
"Thursday",
"Friday",
"Saturday")))
bikesharing <- bikesharing %>%
mutate(weathersit_fct = factor(x = weathersit,
levels = c(1, 2, 3),
labels = c("Good",
"Clouds/Mist",
"Rain/Snow/Storm")))
bikesharing <- bikesharing %>%
mutate(season_fct = factor(x = season,
levels = c(1, 2, 3, 4),
labels = c("Spring",
"Summer",
"Fall",
"Winter")),
month_fct = factor(x = mnth,
levels = c(1,2,3,4,5,6,7,8,9,10,11,12),
labels = c("January",
"February",
"March",
"April",
"May",
"June",
"July",
"August",
"September",
"October",
"November",
"December")))
bikesharing$workingday <- as.factor(bikesharing$workingday)
bikesharing$weekday <- as.factor(bikesharing$weekday)
bikesharing$dteday <- as.Date(bikesharing$dteday)
bikesharing$weekday_fct <- as.character(bikesharing$weekday_fct)
head(bikesharing)
str(bikesharing)
summary(bikesharing)
library(GGally)
GGally::ggpairs(bikesharing[-c(2,17,18,19)])
library(tidyr)
bikesharing_ggally <- bikesharing %>% filter(yr==1) %>% select(temp,workingday,weekday,hum,windspeed,cnt)
library(GGally)
GGally::ggpairs(bikesharing_ggally)
ggplot(bikesharing, mapping=aes(x=dteday,y=cnt)) +
geom_point()
ggplot(filter(bikesharing,yr==1), mapping=aes(x=dteday,y=cnt,color=weathersit_fct)) +
geom_point()+
#facet_grid(~as.factor(season))+
labs(title="Bikesharing over the year 2012 with different weather conditions",x="Date",y="Count (abs)")
ggplot(filter(bikesharing,yr==0),
mapping=aes(x=windspeed,
y=cnt,
)) +
geom_point(aes(color=factor(weathersit_fct)))
ggplot(filter(bikesharing,yr==0),
mapping=aes(x=windspeed,
y=cnt
)) +
geom_point(aes(shape=factor(season)))
ggplot(filter(bikesharing,yr==0),
mapping=aes(x=windspeed,
y=cnt,
)) +
geom_point(aes(size=temp))
ggplot(filter(bikesharing,yr==0),
mapping=aes(x=windspeed,
y=cnt,
)) +
geom_point(aes(color=factor(weathersit_fct))) +
labs(title="Verteilung der numerischen Variablen",x="Windspeed",y="Count",subtitle = "Subtitle example",caption="Caption example\nwith new line")
ggplot(filter(bikesharing,yr==0),
mapping=aes(x=cnt
)) +
geom_density()+
labs(title="Distribution of daily rentals over the year",
x="Rentals",
y="Frequency")
ggplot(filter(bikesharing,yr==0),
mapping=aes(x=cnt,fill=season_fct
)) +
geom_density(alpha=0.5)+
labs(title="Distribution of daily rentals in a month over the year",
x="Rentals",
y="Frequency")
if (!require("hrbrthemes")) install.packages("hrbrthemes")
library(ggridges)
library(ggplot2)
library(viridis)
library(hrbrthemes)
bikesharing_temp <- filter(bikesharing,yr==0)
# Plot
ggplot(bikesharing_temp, aes(x = temp, y = factor(month_fct), fill = ..x..)) +
geom_density_ridges_gradient(scale = 3, rel_min_height = 0.01) +
scale_fill_viridis(name = "Temp. (AU)", option = "C") +
labs(title="Temperatures in 2011",
x="Temperature (norm.)",
y="")+
theme_ipsum() +
theme(
legend.position="none",
panel.spacing = unit(0.1, "lines"),
strip.text.x = element_text(size = 8)+theme(plot.title = element_text(hjust = 0.5))
)
ggplot(filter(bikesharing,yr==0),
mapping=aes(x=cnt
)) +
geom_histogram(fill="#AAA39D")+
labs(title="Distribution of daily rentals over the year",
x="Rentals",
y="Frequency")
ggplot(filter(bikesharing,yr==0), mapping=aes(x=weathersit_fct,y=cnt,fill=weathersit_fct)) +
stat_boxplot(geom = 'errorbar',width = 0.2)+
geom_boxplot(show.legend = FALSE)+
labs(title="Distribution of daily rentals",
x="Weather condition",
y="Rentals")
ggplot(filter(bikesharing,yr==0), mapping=aes(x=weathersit_fct,y=cnt,fill=weathersit_fct)) +
stat_boxplot(geom = 'errorbar',width = 0.2)+
geom_boxplot(show.legend = FALSE)+
geom_jitter(position = position_jitter(w = 0.4, h = 0.1),show.legend = FALSE) +
labs(title="Distribution of daily rentals",
x="Weather condition",
y="Rentals")
ggplot(filter(bikesharing,yr==0), mapping=aes(x=weathersit_fct,y=cnt,fill=weathersit_fct),show.legend = FALSE) +
geom_violin(outlier.shape = NA,show.legend = FALSE)+
geom_jitter(position = position_jitter(w = 0.4, h = 0.1),show.legend = FALSE) +
labs(title="Distribution of daily rentals",
x="Weather condition",
y="Rentals")
ggplot(filter(bikesharing,yr==0), mapping=aes(x=weathersit_fct,y=cnt,fill=weathersit_fct),show.legend = FALSE) +
ggdist::stat_halfeye(aes(),adjust=0.6,justification=-.05,.width=0,point_colour= NA,show.legend = FALSE)+
geom_jitter(show.legend = FALSE,color="#575756",size=1,position = position_jitter(w = 0.1, h = 0.1))+
labs(title="Distribution of daily rentals",
x="Weather condition",
y="Rentals")
library(dplyr)
bikesharing_monthly <- bikesharing %>% select(season,yr,mnth,month_fct,weathersit_fct,cnt) %>% filter(yr==1) %>% group_by(mnth,month_fct) %>% dplyr::summarize(mnth_sum_cnt=sum(cnt))
print(bikesharing_monthly)
ggplot(bikesharing_monthly, aes(x = as.factor(mnth), y=mnth_sum_cnt)) +
geom_col(fill="#AAA39D",show.legend = FALSE) + labs(x="Month", y="Rentals",title="Rentals per month")
ggplot(bikesharing_monthly, aes(x = as.factor(month_fct), y=mnth_sum_cnt)) +
geom_col(fill="#AAA39D",show.legend = FALSE) + labs(x="Month", y="Rentals",title="Rentals per month")
ggplot(bikesharing_monthly, aes(x = as.factor(month_fct), y=mnth_sum_cnt)) +
geom_col(fill="#AAA39D",show.legend = FALSE) + labs(x="Month", y="Rentals",title="Rentals per month") +
coord_flip()
ggplot(filter(bikesharing,yr==1), mapping=aes(x=dteday,y=cnt)) +
geom_point()+
labs(title="Bikesharing over the year 2012",x="Date",y="Count (abs)")
bikesharing_dailyaverage <- bikesharing %>% filter(yr==1) %>% group_by(month_fct) %>% dplyr::summarize(mean=mean(cnt),sd=sd(cnt))
ggplot(bikesharing_dailyaverage , aes(x=month_fct, y=mean)) +
geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.3) +
geom_point(size=2)+
labs(title="Average Daily Rentals",
x="Month",
y="Mean")+
coord_flip()
ggplot(bikesharing_dailyaverage , aes(x=month_fct, y=mean)) +
geom_bar( aes(x=month_fct, y=mean), stat="identity", fill="#AAA39D") +
geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), size=1,width=.3,color="#DF4807") +
labs(title="Average Daily Rentals",
x="Month",
y="Mean")+
coord_flip()
bikesharing_dailyaveragetemperature <- bikesharing %>% filter(yr==1) %>% group_by(month_fct) %>% dplyr::summarize(meancnt=mean(cnt),sdcnt=sd(cnt),meantemp=mean(temp),sdtemp=sd(temp))
ggplot(bikesharing_dailyaveragetemperature,
mapping=aes(x=meantemp,
y=meancnt
)) +
geom_point(aes(color=month_fct))+
geom_errorbar(aes(ymin = meancnt-sdcnt, ymax = meancnt+sdcnt,color=month_fct)) +
geom_errorbarh(aes(xmin = meantemp-sdtemp, xmax = meantemp+sdtemp,color=month_fct))+
#geom_smooth()+
labs(title="Temperature and daily rentals",
x="Temperature (mean)",
y="Count (mean)")
ggplot(bikesharing_dailyaveragetemperature,
mapping=aes(x=meantemp,
y=meancnt
)) +
geom_point(aes(color=month_fct))+
geom_errorbar(aes(ymin = meancnt-sdcnt, ymax = meancnt+sdcnt,color=month_fct)) +
geom_errorbarh(aes(xmin = meantemp-sdtemp, xmax = meantemp+sdtemp,color=month_fct))+
geom_smooth()+
labs(title="Temperature and daily rentals",
x="Temperature (mean)",
y="Count (mean)")
library(dplyr)
library(tidyr)
bikesharing_monthly_casual <- bikesharing %>% select(yr,mnth,casual,registered) %>% filter(yr==1) %>% group_by(mnth) %>% dplyr::summarize(mnth_sum_registered=sum(registered),mnth_sum_casual=sum(casual)) %>%
gather(
key = Type, # new column where old vector names are gathered
value = Measurement, #actual values from the old vectors gathered in one row
mnth_sum_registered,mnth_sum_casual) #vector or row names to be gathered
print(bikesharing_monthly_casual)
ggplot(bikesharing_monthly_casual, aes(x = as.factor(mnth), y=Measurement, fill = Type)) +
geom_col(position = "stack") +
labs(x="Month", y="Rentals",title="Rentals per month")
ggplot(bikesharing_monthly_casual, aes(x = as.factor(mnth), y=Measurement, fill = Type)) +
geom_col(position = "dodge") +
labs(x="Month", y="Rentals",title="Rentals per month")
ggplot(filter(bikesharing,yr==0), mapping=aes(x=windspeed,y=cnt)) +
geom_point()+
geom_smooth()+
labs(title="Wind und Ausleihen",x="Windgeschwindigkeit",y="Count (abs)")
ggplot(filter(bikesharing,yr==0),
mapping=aes(x=windspeed,
y=cnt,
)) +
geom_point(aes(color=factor(weathersit_fct)))+
geom_rug()+
geom_smooth(se=FALSE)
Abb <- ggplot(filter(bikesharing,yr==0),
mapping=aes(x=windspeed,
y=cnt,
)) +
geom_point(aes(color=factor(weathersit_fct)))+
geom_rug()+
geom_smooth(se=FALSE)+
labs(title="Wind und Ausleihen",
x="Windgeschwindigkeit",
y="Count (abs)")
library(ggExtra)
Abb <- ggMarginal(Abb,
type = "boxplot",
fill="transparent",
size=20)
Abb
ggplot(filter(bikesharing,yr==0),
mapping=aes(x=temp,
y=cnt,
)) +
geom_point(aes(color=factor(weathersit_fct)))+
facet_grid(season~weekday_fct)+
labs(title="Weather and rentals by season and weekday",
x="Temperature",
y="Count (abs)")+
theme(plot.title = element_text(hjust = 0.5,color="black",face="bold",size=16)) +
scale_color_brewer(palette="Dark2")
ggplot(filter(bikesharing,yr==0),
mapping=aes(x=temp,
y=cnt,
)) +
geom_point(aes(color=factor(weathersit_fct)))+
facet_wrap(~weekday_fct)+
labs(title="Weather and rentals by season and weekday",
x="Temperature",
y="Count (abs)")+
theme(plot.title = element_text(hjust = 0.5,color="black",face="bold",size=16)) +
scale_color_brewer(palette="Dark2")
ggplot(filter(bikesharing,yr==0),
mapping=aes(x=temp,
y=cnt,
)) +
geom_point(aes(size=windspeed,shape=factor(holiday),color=factor(weathersit_fct)))+
geom_smooth()+
labs(title="Weather and rentals",
x="Temperature",
y="Count (abs)")+
theme(
plot.title = element_text(hjust = 0.5,color="black",face="bold",size=16),
axis.title = element_text(size=12),
axis.text = element_text(size=8),
legend.title = element_text(size=8),
legend.text = element_text(size=8),
plot.background = element_rect(colour = "black", fill=NA, size=0.7))
ggplot(filter(bikesharing,yr==0),
mapping=aes(x=temp,
y=cnt,
)) +
geom_point(aes(size=windspeed,shape=factor(holiday),color=factor(weathersit_fct)))+
geom_smooth()+
labs(title="Weather and rentals",
x="Temperature",
y="Count (abs)") +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5)) # This line centers the title
ggplot(filter(bikesharing,yr==0),
mapping=aes(x=temp,
y=cnt,
)) +
geom_point(aes(size=windspeed,shape=factor(holiday),color=factor(weathersit_fct)))+
geom_smooth()+
labs(title="Weather and rentals",
x="Temperature",
y="Count (abs)") +
theme_classic()
theme(plot.title = element_text(hjust = 0.5)) # This line centers the title
ggplot(filter(bikesharing,yr==0),
mapping=aes(x=temp,
y=cnt,
)) +
geom_point(aes(size=windspeed,shape=factor(holiday),color=factor(weathersit_fct)))+
geom_smooth()+
labs(title="Weather and rentals",
x="Temperature",
y="Count (abs)") +
theme_void() +
theme(plot.title = element_text(hjust = 0.5)) # This line centers the title
library(ggthemes)
ggplot(filter(bikesharing,yr==0),
mapping=aes(x=temp,
y=cnt,
)) +
geom_point(aes(size=windspeed,shape=factor(holiday),color=factor(weathersit_fct)))+
geom_smooth()+
labs(title="Weather and rentals",
x="Temperature",
y="Count (abs)") +
theme_excel_new()
ggplot(filter(bikesharing,yr==0),
mapping=aes(x=temp,
y=cnt,
)) +
geom_point(aes(size=windspeed,shape=factor(holiday),color=factor(weathersit_fct)))+
geom_smooth()+
labs(title="Weather and rentals",
x="Temperature",
y="Count (abs)") +
theme_wsj()
ggplot(filter(bikesharing,yr==0),
mapping=aes(x=temp,
y=cnt,
)) +
geom_point(aes(size=windspeed,shape=factor(holiday),color=factor(weathersit_fct)))+
geom_smooth()+
labs(title="Weather and rentals",
x="Temperature",
y="Count (abs)") +
theme_economist()
ggplot(filter(bikesharing,yr==0), mapping=aes(x=windspeed,y=cnt)) +
geom_point(color="red")+
geom_smooth(color="green")+
labs(title="Wind und Ausleihen",x="Windgeschwindigkeit",y="Count (abs)")
ggplot(filter(bikesharing,yr==0),
mapping=aes(x=cnt
)) +
geom_histogram(fill="#AAA39D")+
labs(title="Distribution of daily rentals over the year",
x="Rentals",
y="Frequency")
library(tidyverse)
library(lubridate)
bikesharing_splitdate <- bikesharing %>% mutate(date = ymd(dteday)) %>%
mutate_at(vars(date), funs(year, month, day)) %>% filter(yr==1)
ggplot(bikesharing_splitdate, aes(day, month_fct, fill= temp)) +
geom_tile() +
labs(title="Temperature",
x="Day",
y="Month")+
scale_fill_gradient(low = "#00699A", high = "#9C0C35")
library(RColorBrewer)
weatherandrentals <- ggplot(filter(bikesharing,yr==0),
mapping=aes(x=temp,
y=cnt,
)) +
geom_point(aes(size=windspeed,shape=factor(holiday),color=factor(weathersit_fct)))+
geom_smooth()+
labs(title="Weather and rentals",
x="Temperature",
y="Count (abs)")+
theme(plot.title = element_text(hjust = 0.5,color="black",face="bold",size=16)) +
scale_color_brewer(palette="Dark2")
print(weatherandrentals)
library(export)
figurebikesharingmonthly <- ggplot(bikesharing_monthly, aes(x = as.factor(mnth), y=mnth_sum_cnt, fill = factor(mnth))) +
geom_col(show.legend = FALSE) + labs(x="Month", y="Rentals",title="Rentals per month")
figurebigkesharingmonthly
library(export)
figurebikesharingmonthly <- ggplot(bikesharing_monthly, aes(x = as.factor(mnth), y=mnth_sum_cnt, fill = factor(mnth))) +
geom_col(show.legend = FALSE) + labs(x="Month", y="Rentals",title="Rentals per month")
figurebikesharingmonthly
graph2ppt(file="exporttest.pptx", width=6.5, height=5)
ggsave(file="bikesharingmonthly.jpeg",plot=figurebikesharingmonthly,width=5, height=4)
ggsave(file="bikesharingmonthly.pdf",plot=figurebikesharingmonthly,device = "pdf",width=5, height=4)
ggsave(file="bikesharingmonthly.svg",plot=figurebikesharingmonthly,device = "svg",width=5, height=4)
View(bikesharing)
ggplot(filter(bikesharing,yr==0), mapping=aes(x=weathersit_fct,y=cnt,fill=weathersit_fct)) +
stat_boxplot(geom = 'errorbar',width = 0.2)+
geom_boxplot(show.legend = FALSE)+
geom_point(position = position_jitter(w = 0.4, h = 0.1),show.legend = FALSE) +
labs(title="Distribution of daily rentals",
x="Weather condition",
y="Rentals")
ggplot(filter(bikesharing,yr==0), mapping=aes(x=weathersit_fct,y=cnt,fill=weathersit_fct)) +
stat_boxplot(geom = 'errorbar',width = 0.2)+
geom_boxplot(show.legend = FALSE)+
geom_jitter(position = position_jitter(w = 0.4, h = 0.1),show.legend = FALSE) +
labs(title="Distribution of daily rentals",
x="Weather condition",
y="Rentals")
ggplot(filter(bikesharing,yr==0), mapping=aes(x=weathersit_fct,y=cnt,fill=weathersit_fct)) +
stat_boxplot(geom = 'errorbar',width = 0.2)+
geom_boxplot(show.legend = FALSE)+
geom_point()+
#geom_jitter(position = position_jitter(w = 0.4, h = 0.1),show.legend = FALSE) +
labs(title="Distribution of daily rentals",
x="Weather condition",
y="Rentals")
ggplot(filter(bikesharing,yr==0), mapping=aes(x=weathersit_fct,y=cnt,fill=weathersit_fct)) +
stat_boxplot(geom = 'errorbar',width = 0.2)+
geom_boxplot(show.legend = FALSE)+
geom_jitter(position = position_jitter(w = 0.4, h = 0.1),show.legend = FALSE) +
labs(title="Distribution of daily rentals",
x="Weather condition",
y="Rentals")
ggplot(filter(bikesharing,yr==0), mapping=aes(x=weathersit_fct,y=cnt,fill=weathersit_fct)) +
stat_boxplot(geom = 'errorbar',width = 0.2)+
geom_boxplot(show.legend = FALSE)+
geom_jitter(position = position_jitter(w = 0.2, h = 0.1),show.legend = FALSE) +
labs(title="Distribution of daily rentals",
x="Weather condition",
y="Rentals")
ggplot(filter(bikesharing,yr==0), mapping=aes(x=weathersit_fct,y=cnt,fill=weathersit_fct)) +
stat_boxplot(geom = 'errorbar',width = 0.2)+
geom_boxplot(show.legend = FALSE)+
geom_jitter(position = position_jitter(w = 0.4, h = 0.1),show.legend = FALSE) +
labs(title="Distribution of daily rentals",
x="Weather condition",
y="Rentals")
ggplot(filter(bikesharing,yr==0),
mapping=aes(x=temp,
y=cnt,
)) +
geom_point(aes(color=factor(weathersit_fct)))+
#facet_grid(season~weekday_fct)+
labs(title="Weather and rentals by season and weekday",
x="Temperature",
y="Count (abs)")+
theme(plot.title = element_text(hjust = 0.5,color="black",face="bold",size=16)) +
scale_color_brewer(palette="Dark2")
ggplot(filter(bikesharing,yr==0),
mapping=aes(x=temp,
y=cnt,
)) +
geom_point(aes(color=factor(weathersit_fct)))+
facet_grid(season~weekday_fct)+
labs(title="Weather and rentals by season and weekday",
x="Temperature",
y="Count (abs)")+
theme(plot.title = element_text(hjust = 0.5,color="black",face="bold",size=16)) +
scale_color_brewer(palette="Dark2")
patchplot
source("C:/Users/PrinzDrChristian(SRH/OneDrive - SRH Fernhochschule/Dokumente/R/SRHTemplate/srhcolorsandthemes.R", echo=FALSE)
# theme_srh() + scale_srh()
A <- ggplot(filter(bikesharing,yr==0), mapping=aes(x=dteday,y=cnt)) +
geom_point() +
labs(title="Rentals over the year",
x="Date",
y="Count (abs)") +
theme_srh() + scale_color_srh(palette="3cols") +
theme(
axis.text.x=element_blank(),
axis.ticks.x=element_blank())
B <- ggplot(bikesharing_monthly, aes(x = as.factor(mnth), y=mnth_sum_cnt, fill = factor(mnth))) +
geom_col(show.legend = FALSE) + labs(x="Month", y="Rentals",title="Rentals per month") +
theme_srh() + scale_fill_srh(palette = "12cols")
C <- ggplot(filter(bikesharing,yr==0), mapping=aes(x=weathersit_fct,y=cnt,fill=weathersit_fct)) +
geom_boxplot(show.legend = FALSE)+
geom_jitter(show.legend = FALSE)+
labs(title="Weather and rentals",x="Weather",y="Count (abs)") +
theme_srh() + scale_fill_srh(palette = "3cols")
D <- ggplot(filter(bikesharing,yr==0),
mapping=aes(x=temp,
y=cnt,
)) +
geom_point(aes(size=windspeed,shape=factor(holiday),color=factor(weathersit_fct)))+
geom_smooth(color="#DF4807")+
labs(title="Weather and rentals",
x="Temperature",
y="Count (abs)") +
theme_srh() + scale_color_srh(palette="3cols")
library(patchwork)
patchplot <- (A/B/C/D) + plot_layout(ncol=2,widths=c(1,1))+
plot_annotation(
title = 'Bike rentals',
theme = theme_srh(),
tag_levels = 'A') &
theme(plot.tag = element_text(size = 10))
patchplot
graph2ppt(file="patchplot.pptx", width=13, height=10)
